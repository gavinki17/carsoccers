<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Web Rocket League Prototype</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: sans-serif; }
        #ui { position: absolute; top: 20px; left: 20px; color: white; pointer-events: none; }
    </style>
</head>
<body>
    <div id="ui">
        <h1>Web League 3D</h1>
        <p>WASD to Drive | Space to Jump/Flip | Shift to Boost</p>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "cannon-es": "https://unpkg.com/cannon-es@0.20.0/dist/cannon-es.js"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import * as CANNON from 'cannon-es';

        // --- SETUP SCENE & PHYSICS ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87ceeb); // Sky blue
        const world = new CANNON.World({ gravity: new CANNON.Vec3(0, -9.82, 0) });
        
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // --- LIGHTING ---
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);
        const sun = new THREE.DirectionalLight(0xffffff, 1);
        sun.position.set(10, 20, 10);
        scene.add(sun);

        // --- THE ARENA ---
        // Floor
        const groundMat = new THREE.MeshStandardMaterial({ color: 0x228b22 });
        const groundGeo = new THREE.PlaneGeometry(100, 150);
        const ground = new THREE.Mesh(groundGeo, groundMat);
        ground.rotation.x = -Math.PI / 2;
        scene.add(ground);

        const groundBody = new CANNON.Body({ mass: 0, shape: new CANNON.Plane() });
        groundBody.quaternion.setFromEuler(-Math.PI / 2, 0, 0);
        world.addBody(groundBody);

        // Simple Arena Walls & Roof
        const arenaMaterial = new THREE.MeshStandardMaterial({ color: 0x444444, transparent: true, opacity: 0.3 });
        const wallG = new THREE.BoxGeometry(100, 40, 1);
        const wall = new THREE.Mesh(wallG, arenaMaterial);
        wall.position.set(0, 20, 75); // Back wall
        scene.add(wall);

        // --- THE BALL ---
        const ballGeo = new THREE.SphereGeometry(2, 32, 32);
        const ballMat = new THREE.MeshStandardMaterial({ color: 0xffffff });
        const ballMesh = new THREE.Mesh(ballGeo, ballMat);
        scene.add(ballMesh);

        const ballBody = new CANNON.Body({
            mass: 1,
            shape: new CANNON.Sphere(2),
            material: new CANNON.Material({ restitution: 0.9 }) // Bouncy!
        });
        ballBody.position.set(0, 10, 0);
        world.addBody(ballBody);

        // --- THE CAR (CHASSIS) ---
        const carGeo = new THREE.BoxGeometry(2, 1, 4);
        const carMat = new THREE.MeshStandardMaterial({ color: 0xff0000 });
        const carMesh = new THREE.Mesh(carGeo, carMat);
        scene.add(carMesh);

        const carBody = new CANNON.Body({ mass: 5, shape: new CANNON.Box(new CANNON.Vec3(1, 0.5, 2)) });
        carBody.position.set(0, 2, 50);
        world.addBody(carBody);

        // --- INPUT HANDLING ---
        const keys = {};
        window.addEventListener('keydown', (e) => keys[e.key.toLowerCase()] = true);
        window.addEventListener('keyup', (e) => keys[e.key.toLowerCase()] = false);

        // --- GAME LOOP ---
        function animate() {
            requestAnimationFrame(animate);
            world.fixedStep();

            // Movement Physics
            const force = 40;
            const torque = 5;

            if (keys['w']) {
                const vector = new CANNON.Vec3(0, 0, -force);
                carBody.applyLocalForce(vector, new CANNON.Vec3(0, 0, 0));
            }
            if (keys['s']) {
                const vector = new CANNON.Vec3(0, 0, force);
                carBody.applyLocalForce(vector, new CANNON.Vec3(0, 0, 0));
            }
            if (keys['a']) carBody.angularVelocity.y = torque;
            if (keys['d']) carBody.angularVelocity.y = -torque;
            
            // Jump / Flip Logic
            if (keys[' ']) {
                if (Math.abs(carBody.velocity.y) < 0.1) {
                    carBody.velocity.y = 10; // Simple Jump
                }
            }

            // Sync Visuals with Physics
            carMesh.position.copy(carBody.position);
            carMesh.quaternion.copy(carBody.quaternion);
            ballMesh.position.copy(ballBody.position);
            ballMesh.quaternion.copy(ballBody.quaternion);

            // Follow Camera
            const cp = carBody.position;
            camera.position.set(cp.x, cp.y + 5, cp.z + 15);
            camera.lookAt(cp.x, cp.y, cp.z);

            renderer.render(scene, camera);
        }

        animate();
    </script>
</body>
</html>
